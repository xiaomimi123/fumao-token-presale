<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合约所有者检测工具</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #181818;
            color: #c7dca9;
        }
        .card {
            background: #242424;
            border: 1px solid #464342;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #f4ce59;
            color: #181818;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #63b657;
        }
        .info {
            margin: 10px 0;
            padding: 10px;
            background: #181818;
            border-radius: 5px;
            word-break: break-all;
        }
        .success {
            color: #63b657;
        }
        .error {
            color: #ff6b6b;
        }
        .warning {
            color: #ffa502;
        }
        h1 {
            color: #f4ce59;
        }
        h2 {
            color: #f4ce59;
            font-size: 18px;
        }
        pre {
            background: #181818;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🔍 福猫代币合约所有者检测工具</h1>
    
    <div class="card">
        <h2>1️⃣ 连接钱包</h2>
        <button onclick="connectWallet()">连接 MetaMask</button>
        <div id="walletInfo" class="info" style="margin-top: 10px;"></div>
    </div>

    <div class="card">
        <h2>2️⃣ 检测结果</h2>
        <div id="result"></div>
    </div>

    <div class="card">
        <h2>📋 合约配置</h2>
        <div class="info">
            <strong>预售合约地址:</strong><br>
            <span style="font-family: monospace;">0x198b933836a600c716892E80F4Bde84186Ebff6d</span>
        </div>
        <div class="info">
            <strong>BSC 测试网 Chain ID:</strong> 97
        </div>
    </div>

    <script>
        const PRESALE_ADDRESS = '0x198b933836a600c716892E80F4Bde84186Ebff6d';
        const PRESALE_ABI = [
            "function owner() view returns (address)",
            "function bnbRate() view returns (uint256)",
            "function usdtRate() view returns (uint256)"
        ];

        let currentAccount = null;

        async function connectWallet() {
            const walletInfo = document.getElementById('walletInfo');
            const result = document.getElementById('result');
            
            try {
                if (!window.ethereum) {
                    walletInfo.innerHTML = '<span class="error">❌ 未检测到 MetaMask！请先安装 MetaMask 钱包。</span>';
                    return;
                }

                // 请求连接钱包
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                currentAccount = accounts[0];

                // 检查网络
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                const chainIdDecimal = parseInt(chainId, 16);

                walletInfo.innerHTML = `
                    <div class="success">✅ 钱包已连接</div>
                    <div><strong>当前地址:</strong> ${currentAccount}</div>
                    <div><strong>当前网络:</strong> ${chainIdDecimal} ${chainIdDecimal === 97 ? '(BSC 测试网 ✅)' : '(⚠️ 请切换到 BSC 测试网)'}</div>
                `;

                // 检查合约所有者
                await checkOwner();

            } catch (error) {
                walletInfo.innerHTML = `<span class="error">❌ 连接失败: ${error.message}</span>`;
                console.error(error);
            }
        }

        async function checkOwner() {
            const result = document.getElementById('result');
            result.innerHTML = '<div>⏳ 正在检查合约所有者...</div>';

            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const presaleContract = new ethers.Contract(
                    PRESALE_ADDRESS,
                    PRESALE_ABI,
                    provider
                );

                // 获取合约所有者
                const owner = await presaleContract.owner();
                
                // 获取汇率信息（测试合约是否正常）
                const bnbRate = await presaleContract.bnbRate();
                const usdtRate = await presaleContract.usdtRate();

                // 比较地址
                const isOwner = owner.toLowerCase() === currentAccount.toLowerCase();

                result.innerHTML = `
                    <div class="info">
                        <strong>合约所有者地址:</strong><br>
                        <span style="font-family: monospace;">${owner}</span>
                    </div>
                    <div class="info">
                        <strong>当前钱包地址:</strong><br>
                        <span style="font-family: monospace;">${currentAccount}</span>
                    </div>
                    <div class="info">
                        <strong>地址匹配:</strong> 
                        ${isOwner ? 
                            '<span class="success">✅ 是合约所有者！可以访问管理后台</span>' : 
                            '<span class="error">❌ 不是合约所有者，无法访问管理后台</span>'}
                    </div>
                    <div class="info">
                        <strong>合约状态:</strong> <span class="success">✅ 正常</span><br>
                        <strong>BNB 兑换率:</strong> ${bnbRate.toString()} FM/BNB<br>
                        <strong>USDT 兑换率:</strong> ${usdtRate.toString()} FM/USDT
                    </div>
                    ${isOwner ? `
                        <div style="margin-top: 20px;">
                            <a href="/admin" style="display: inline-block; background: #f4ce59; color: #181818; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold;">
                                🔐 进入管理后台
                            </a>
                        </div>
                    ` : ''}
                `;

            } catch (error) {
                result.innerHTML = `
                    <div class="error">❌ 检查失败</div>
                    <pre>${error.message}</pre>
                    <div class="warning" style="margin-top: 10px;">
                        <strong>可能的原因：</strong><br>
                        1. 未连接到 BSC 测试网（Chain ID 97）<br>
                        2. 合约地址不正确<br>
                        3. 网络连接问题<br>
                        4. MetaMask 未授权
                    </div>
                `;
                console.error(error);
            }
        }

        // 监听账户变化
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }
    </script>
</body>
</html>

