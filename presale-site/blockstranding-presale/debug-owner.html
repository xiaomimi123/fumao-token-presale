<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆçº¦æ‰€æœ‰è€…æ£€æµ‹å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #181818;
            color: #c7dca9;
        }
        .card {
            background: #242424;
            border: 1px solid #464342;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #f4ce59;
            color: #181818;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #63b657;
        }
        .info {
            margin: 10px 0;
            padding: 10px;
            background: #181818;
            border-radius: 5px;
            word-break: break-all;
        }
        .success {
            color: #63b657;
        }
        .error {
            color: #ff6b6b;
        }
        .warning {
            color: #ffa502;
        }
        h1 {
            color: #f4ce59;
        }
        h2 {
            color: #f4ce59;
            font-size: 18px;
        }
        pre {
            background: #181818;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç¦çŒ«ä»£å¸åˆçº¦æ‰€æœ‰è€…æ£€æµ‹å·¥å…·</h1>
    
    <div class="card">
        <h2>1ï¸âƒ£ è¿æ¥é’±åŒ…</h2>
        <button onclick="connectWallet()">è¿æ¥ MetaMask</button>
        <div id="walletInfo" class="info" style="margin-top: 10px;"></div>
    </div>

    <div class="card">
        <h2>2ï¸âƒ£ æ£€æµ‹ç»“æœ</h2>
        <div id="result"></div>
    </div>

    <div class="card">
        <h2>ğŸ“‹ åˆçº¦é…ç½®</h2>
        <div class="info">
            <strong>é¢„å”®åˆçº¦åœ°å€:</strong><br>
            <span style="font-family: monospace;">0x198b933836a600c716892E80F4Bde84186Ebff6d</span>
        </div>
        <div class="info">
            <strong>BSC æµ‹è¯•ç½‘ Chain ID:</strong> 97
        </div>
    </div>

    <script>
        const PRESALE_ADDRESS = '0x198b933836a600c716892E80F4Bde84186Ebff6d';
        const PRESALE_ABI = [
            "function owner() view returns (address)",
            "function bnbRate() view returns (uint256)",
            "function usdtRate() view returns (uint256)"
        ];

        let currentAccount = null;

        async function connectWallet() {
            const walletInfo = document.getElementById('walletInfo');
            const result = document.getElementById('result');
            
            try {
                if (!window.ethereum) {
                    walletInfo.innerHTML = '<span class="error">âŒ æœªæ£€æµ‹åˆ° MetaMaskï¼è¯·å…ˆå®‰è£… MetaMask é’±åŒ…ã€‚</span>';
                    return;
                }

                // è¯·æ±‚è¿æ¥é’±åŒ…
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                currentAccount = accounts[0];

                // æ£€æŸ¥ç½‘ç»œ
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                const chainIdDecimal = parseInt(chainId, 16);

                walletInfo.innerHTML = `
                    <div class="success">âœ… é’±åŒ…å·²è¿æ¥</div>
                    <div><strong>å½“å‰åœ°å€:</strong> ${currentAccount}</div>
                    <div><strong>å½“å‰ç½‘ç»œ:</strong> ${chainIdDecimal} ${chainIdDecimal === 97 ? '(BSC æµ‹è¯•ç½‘ âœ…)' : '(âš ï¸ è¯·åˆ‡æ¢åˆ° BSC æµ‹è¯•ç½‘)'}</div>
                `;

                // æ£€æŸ¥åˆçº¦æ‰€æœ‰è€…
                await checkOwner();

            } catch (error) {
                walletInfo.innerHTML = `<span class="error">âŒ è¿æ¥å¤±è´¥: ${error.message}</span>`;
                console.error(error);
            }
        }

        async function checkOwner() {
            const result = document.getElementById('result');
            result.innerHTML = '<div>â³ æ­£åœ¨æ£€æŸ¥åˆçº¦æ‰€æœ‰è€…...</div>';

            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const presaleContract = new ethers.Contract(
                    PRESALE_ADDRESS,
                    PRESALE_ABI,
                    provider
                );

                // è·å–åˆçº¦æ‰€æœ‰è€…
                const owner = await presaleContract.owner();
                
                // è·å–æ±‡ç‡ä¿¡æ¯ï¼ˆæµ‹è¯•åˆçº¦æ˜¯å¦æ­£å¸¸ï¼‰
                const bnbRate = await presaleContract.bnbRate();
                const usdtRate = await presaleContract.usdtRate();

                // æ¯”è¾ƒåœ°å€
                const isOwner = owner.toLowerCase() === currentAccount.toLowerCase();

                result.innerHTML = `
                    <div class="info">
                        <strong>åˆçº¦æ‰€æœ‰è€…åœ°å€:</strong><br>
                        <span style="font-family: monospace;">${owner}</span>
                    </div>
                    <div class="info">
                        <strong>å½“å‰é’±åŒ…åœ°å€:</strong><br>
                        <span style="font-family: monospace;">${currentAccount}</span>
                    </div>
                    <div class="info">
                        <strong>åœ°å€åŒ¹é…:</strong> 
                        ${isOwner ? 
                            '<span class="success">âœ… æ˜¯åˆçº¦æ‰€æœ‰è€…ï¼å¯ä»¥è®¿é—®ç®¡ç†åå°</span>' : 
                            '<span class="error">âŒ ä¸æ˜¯åˆçº¦æ‰€æœ‰è€…ï¼Œæ— æ³•è®¿é—®ç®¡ç†åå°</span>'}
                    </div>
                    <div class="info">
                        <strong>åˆçº¦çŠ¶æ€:</strong> <span class="success">âœ… æ­£å¸¸</span><br>
                        <strong>BNB å…‘æ¢ç‡:</strong> ${bnbRate.toString()} FM/BNB<br>
                        <strong>USDT å…‘æ¢ç‡:</strong> ${usdtRate.toString()} FM/USDT
                    </div>
                    ${isOwner ? `
                        <div style="margin-top: 20px;">
                            <a href="/admin" style="display: inline-block; background: #f4ce59; color: #181818; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold;">
                                ğŸ” è¿›å…¥ç®¡ç†åå°
                            </a>
                        </div>
                    ` : ''}
                `;

            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ æ£€æŸ¥å¤±è´¥</div>
                    <pre>${error.message}</pre>
                    <div class="warning" style="margin-top: 10px;">
                        <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                        1. æœªè¿æ¥åˆ° BSC æµ‹è¯•ç½‘ï¼ˆChain ID 97ï¼‰<br>
                        2. åˆçº¦åœ°å€ä¸æ­£ç¡®<br>
                        3. ç½‘ç»œè¿æ¥é—®é¢˜<br>
                        4. MetaMask æœªæˆæƒ
                    </div>
                `;
                console.error(error);
            }
        }

        // ç›‘å¬è´¦æˆ·å˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }
    </script>
</body>
</html>

